<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script type="text/javascript" src="d3/d3.min.js"></script>
    <title>Geo Test</title>
</head>
<body>
<script type="text/javascript">
    //Width and height
    var w = 760;
    var h = 600;

    //Define map projection
    var projection = d3.geoMercator()
        .center([ -120, 37 ])
        .translate([ w/2, h/2 ])
        .scale([ w*3.3 ]);

    //Define path generator
    var path = d3.geoPath()
        .projection(projection);

    // Define linear scale for output
    var color = d3.scaleLinear()
        .range(["rgb(213,222,217)","rgb(69,173,168)","rgb(84,36,55)","rgb(217,91,67)"]);

    //Create SVG element and append map to the SVG
    var svg = d3.select("body")
        .append("svg")
        .attr("width", w)
        .attr("height", h);
    var g = d3.select('svg').append('g').attr('id', 'mapcontainer')

    var countyName = window.location.search.substring(8)

    //Load CA county map
    d3.json("cb_2014_us_county_5m.json")
    .then(function(ca) {
        // Join the FeatureCollection's features array to path elements
        var selectCounty = ca.features.filter(function(d) { return d.properties.NAME == countyName; });
        g.selectAll("path")
            .data(selectCounty)
            .enter()
            .append("path")
            .attr("d", path)
            .style('fill', 'rgb(69,173,168)');
    });
    d3.csv('fhab_bloomreport.csv').then(function(data) {
        var countbylocation = d3.nest()
            .key(function(d) {return [d.Longitude, d.Latitude];})
            .rollup(function(v) {return v.length;})
            .entries(data);
        g.selectAll('circle').data(countbylocation).enter().append('circle')
        .attr('cx', function(d) {
            return projection([d.key.split(',')[0], d.key.split(',')[1]])[0];
        })
        .attr('cy', function(d) {
            return projection([d.key.split(',')[0], d.key.split(',')[1]])[1];
        })
        .attr("r", function(d) {return d.value;})
        .style("fill", "red");
        });

    // todo: need to figure out the zoom function
    const zoom = d3
        .zoom()
        .scaleExtent([1,100])
        .on("zoom", zoomHandler);
    function zoomHandler() {
        g.attr("transform", d3.event.transform);
    }

</script>
</body>
</html>
